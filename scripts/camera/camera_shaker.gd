class_name CameraShaker extends Resource

var shake_factor:float = 10.0
var shake_duration:float = 0.1
var shake_per_sec:float = 0.01

var duration: Timer
var physics: Timer
	
func screen_shake(factor:float, time_duration:float):
	if duration == null or physics == null:
		duration = Timer.new()
		physics = Timer.new()
		duration.timeout.connect(duration_timeout)
		physics.timeout.connect(physics_timeout)
		
		CAV.camera_node.add_child(duration)
		CAV.camera_node.add_child(physics)
	
	shake_factor = factor
	shake_duration = time_duration
	
	duration.wait_time = shake_duration
	duration.one_shot = true
	duration.autostart = false
	
	physics.wait_time = shake_per_sec
	physics.one_shot = false
	physics.autostart = false
	
	duration.start()
	physics.start()

func shake():
	var shake_duration_normalized = duration.time_left/shake_duration
	var rng = Vector2(	randf_range(-shake_factor*shake_duration_normalized,shake_factor*shake_duration_normalized)	,
						randf_range(-shake_factor*shake_duration_normalized,shake_factor*shake_duration_normalized)	)
	CAV.camera_node.position += rng

func duration_timeout():
	duration.queue_free()
	physics.queue_free()
	
func physics_timeout():
	shake()

func shake_short_weak():
	screen_shake(0.75, 0.25)
func shake_short_medium():
	screen_shake(1.2, 0.25)
func shake_short_strong():
	screen_shake(2.0, 0.25)

func shake_medium_weak():
	screen_shake(0.75, 0.8)
func shake_medium_medium():
	screen_shake(1.2, 0.8)
func shake_medium_strong():
	screen_shake(2.0, 0.8)
	
func shake_long_weak():
	screen_shake(0.75, 1.2)
func shake_long_medium():
	screen_shake(1.2, 1.2)
func shake_long_strong():
	screen_shake(2.0, 1.2)
	
func comically_strong_shake():
	screen_shake(100, 5)
