class_name PlayerMovementControls extends Node2D

@export var running_speed := 300.0

const TERMINAL_VELOCITY := 850.0
const DRAG := 5.0
const DRAG_ON_AIR := 10.0

var player: Player:
	get: return owner
var direction: int

func _input(event: InputEvent) -> void:
	direction = Input.get_axis("Left", "Right") as int

func _physics_process(delta: float) -> void:
	_run(delta)
	_cap_to_terminal_velocity()

func _run(delta: float) -> void:
	if Player.enable_input == Player.ENABLE_INPUT.DISABLED:
		if player.is_on_floor():
			direction = 0
		else:
			return
	var SPEED_devider: float = DRAG if player.is_on_floor() else DRAG_ON_AIR
	if abs(player.velocity.x) > running_speed:
		SPEED_devider *= 2.0
	player.velocity.x = move_toward(player.velocity.x,
									direction * running_speed,
									running_speed/(SPEED_devider if direction else SPEED_devider * 2.0)	)

func _cap_to_terminal_velocity() -> void:
	player.velocity = Vector2(	clamp(player.velocity.x, -TERMINAL_VELOCITY, TERMINAL_VELOCITY),
								clamp(player.velocity.y, -TERMINAL_VELOCITY, TERMINAL_VELOCITY)	)
