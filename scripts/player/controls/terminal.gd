extends Node2D

var player: Player:
	get: return owner
var player_jump_controls: PlayerJumpControls:
	get: return get_node("%PlayerJumpControls")
var terminal: Terminal:
	get: return Terminal.instance
var sfx: SFXPlayer:
	get: return $SFXPlayer

func _ready() -> void:
	player_jump_controls.touched_floor.connect(_touched_floor)
	terminal.time_out.connect(_terminal_timeout)

func _input(event: InputEvent) -> void:
	if event.is_action_pressed("Terminal") and Terminal.current_status == Terminal.STATUS.CLOSE:
		if Terminal.current_mode == Terminal.MODE.UNSAFE:
			if player.is_on_floor():
				return
			if Terminal.instance.processing_power <= 25.0:
				return
			Timemode.current_time_mode = Timemode.TIME_MODE.SLOWMO
			VFX.shockwave.spawn(VFX.shockwave.STRENGTH.LARGE, player)
			sfx.play()
		terminal.open()
		
	if event.is_action_pressed("Pause") and Terminal.current_status == Terminal.STATUS.OPEN:
		terminal.close()
		sfx.stop()

func _touched_floor() -> void:
	if Terminal.current_status == Terminal.STATUS.OPEN and Terminal.current_mode == Terminal.MODE.UNSAFE:
		terminal.close()
		sfx.stop()

func _terminal_timeout() -> void:
	terminal.close()
	sfx.stop()
	
