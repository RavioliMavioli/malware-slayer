extends Node2D

var player: PlayerInstance:
	get: return owner

var terminal: Terminal:
	get: return get_tree().current_scene.get_node("%FollowPlayer").get_node("Terminal")

func _input(event: InputEvent) -> void:
	if event.is_action_pressed("Terminal") and Terminal.current_status == Terminal.STATUS.CLOSE:
		if Terminal.current_mode == Terminal.MODE.UNSAFE:
			if player.is_on_floor():
				return
			if Terminal.get_processing_power_val() <= 25.0:
				return
			Timemode.current_time_mode = Timemode.TIME_MODE.SLOWMO
			VFX.shockwave.spawn(VFX.shockwave.STRENGTH.LARGE, player)
		terminal.open()
		
	if event.is_action_pressed("Pause") and Terminal.current_status == Terminal.STATUS.OPEN:
		terminal.close()
		Timemode.current_time_mode = Timemode.TIME_MODE.NORMAL

func _physics_process(delta: float) -> void:
	if (Terminal.current_status == Terminal.STATUS.OPEN
		and Terminal.current_mode == Terminal.MODE.UNSAFE
		and player.is_on_floor()):
			
		terminal.close()
		Timemode.current_time_mode = Timemode.TIME_MODE.NORMAL
		
	if Terminal.get_processing_power_val() == 0.0:
		terminal.close()
		Timemode.current_time_mode = Timemode.TIME_MODE.NORMAL
		
		
		
