extends Node2D

@export var speed := 0.05
@export var char_offset := -13
@export var cycle := 2

var title:
	get: return get_parent()
var ascii: PackedByteArray
var init_ascii: PackedByteArray
var timer: SceneTreeTimer

func _ready() -> void:
	ascii = title.text.to_ascii_buffer()
	init_ascii = title.text.to_ascii_buffer()
	
	timer = get_tree().create_timer(speed)
	timer.timeout.connect(_timeout)
	
	_set_char_offset(ascii, char_offset)
	title.text = ascii.get_string_from_ascii()
	
func _timeout() -> void:
	timer = get_tree().create_timer(speed)
	timer.timeout.connect(_timeout)
	ascii = title.text.to_ascii_buffer()
	
	for i in range(ascii.size()):
		ascii[i] = ascii[i] + 1
	if ascii[0] == init_ascii[0]:
		if cycle != 0:
			cycle -= 1
			_set_char_offset(ascii, char_offset)
		else:
			timer.timeout.disconnect(_timeout)
	title.text = ascii.get_string_from_ascii()
	
func _set_char_offset(str, offset) -> void:
	for i in range(str.size()):
		str[i] = str[i] + offset
