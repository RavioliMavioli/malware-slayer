class_name FloatingPositionManager extends Resource
# Manage the position of UI or other nodes outside the SubViewport,
# in which has to follow nodes inside the SubViewport.
# It is done by extracting the target node global position into canvas position,
# Then scaled, offseted, and applied to the UI node.
var floating_element: Control
var target_node: Node2D

var resized_screen_center: Vector2
var screen_center: Vector2
var d_screen_center: Vector2
var offset: Vector2 = Vector2.ZERO
var target: Vector2 = Vector2.ZERO

func _init(_floating_element: Control, _target_node: Node2D = null):
	floating_element = _floating_element
	if _target_node != null:
		target_node = _target_node

func physics():
	resized_screen_center = CAV.container_default_size * CAV.viewport_container_node.scale / 2
	screen_center = CAV.screen_resolution / 2
	d_screen_center = screen_center - resized_screen_center
	offset = resized_screen_center
	if target_node != null:
		target = target_node.global_position * CAV.viewport_container_node.scale
	
	floating_element.scale = CAV.viewport_container_node.scale
	floating_element.global_position = (
		(-	CAV.camera_node.global_position 		*
			CAV.viewport_container_node.scale	) 	+
			d_screen_center 						+
			offset + target)
