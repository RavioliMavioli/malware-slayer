extends BackBufferCopy

@export var lifespan: float
@export var speed: float
@export var initial_size: float
@onready var shockwave: ColorRect = $Shockwave

var timer: Timer
var shock_size: float
var force: float

func _ready():
	shock_size = initial_size
	timer = Timer.new()
	add_child(timer)
	timer.wait_time = 3.0
	timer.one_shot = true
	timer.timeout.connect(_timeout)
	timer.start()
	force = shockwave.material.get("shader_parameter/force")
	shockwave.material.set("shader_parameter/preview_atlas", false)
func _process(delta):
	shockwave.material.set("shader_parameter/position", Player.player_node.get_global_transform_with_canvas().origin)
	shockwave.material.set("shader_parameter/size", shock_size)
	shockwave.material.set("shader_parameter/force", force)
	
	shock_size += delta/(1/speed * 10)
	if force >= 0:
		force -= delta/(lifespan)

func _timeout():
	queue_free()
