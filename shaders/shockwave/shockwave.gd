extends BackBufferCopy

@export var lifespan: float
@export var speed: float
@export var initial_size: float
@onready var shockwave: ColorRect = $Shockwave

var initial_force: float
var shock_size: float
var force: float
var expanding: bool = false

func _ready():
	shock_size = initial_size
	initial_force = shockwave.material.get("shader_parameter/force")
	shockwave.material.set("shader_parameter/preview_atlas", false)
	force = 0.0
	
func _process(delta):
	
	shockwave.material.set("shader_parameter/position", Player.player_node.get_global_transform_with_canvas().origin)
	shockwave.material.set("shader_parameter/size", shock_size)
	shockwave.material.set("shader_parameter/force", force)
	
	shock_size += delta/(1/speed * 10)
	
	if !expanding:
		force += delta*2
		if force >= initial_force:
			expanding = true
			force = initial_force
			
	else:
		force -= delta/(lifespan)
		if force <= 0:
			set_process(false)
			queue_free()
		

