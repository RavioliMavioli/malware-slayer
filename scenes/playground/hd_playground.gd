extends Node

@onready var crosshair: Sprite2D = $UI/Crosshair
@onready var floating_text: Node2D = $FloatingText
@onready var view_box: SubViewportContainer = $SubViewportContainer
@onready var sub_viewport: SubViewport = $SubViewportContainer/SubViewport
@onready var screen_res: Vector2 = get_viewport().size as Vector2
@onready var floating_text_manager: FloatingTextManager = FloatingTextManager.new(floating_text)

const HEIGHT: int = 1024
const WIDTH: int = 576

func _ready():
	
	Input.set_mouse_mode(Input.MOUSE_MODE_HIDDEN)
	
	CAV.viewport_container_node = view_box
	CAV.viewport_node = sub_viewport
	
	#################### Screen Size ########################
	
	sub_viewport.size = Vector2i(HEIGHT, WIDTH)
	view_box.size = sub_viewport.size
	
	CAV.container_default_position = view_box.position
	CAV.container_default_size = sub_viewport.size as Vector2
	CAV.container_default_scaling = screen_res / CAV.container_default_size
	
	CAV.screen_resolution = screen_res
	
	view_box.scale = CAV.container_default_scaling

func _physics_process(delta):
	floating_text_manager.physics()
	crosshair_physics()
	

func crosshair_physics():
	crosshair.global_position = view_box.get_global_mouse_position()
