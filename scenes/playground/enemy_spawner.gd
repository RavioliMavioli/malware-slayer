extends Node2D

@export var enemy_scene: PackedScene
@onready var spawner: Marker2D = $Spawner
var i:int = 1
var timer: Timer = Timer.new()
var dir = 1
const SPEED = 100
const MAX_POS = 1000.0

func _ready():
	timer.autostart = true
	timer.one_shot = false
	timer.wait_time = 2
	add_child(timer)
	timer.timeout.connect(spawn)
	timer.start()
	
func _process(delta):
	
	if spawner.global_position.x >= MAX_POS:
		spawner.global_position.x = MAX_POS
		dir = -dir
	elif spawner.global_position.x <= -MAX_POS:
		spawner.global_position.x = -MAX_POS
		dir = -dir
		
	spawner.global_position.x += dir * SPEED * delta

func spawn():
	for e in EntityPooler.enemy_pool:
		if e == null:
			EntityPooler.enemy_pool.erase(e)
	if EntityPooler.enemy_pool.size() <= 10:
		i += 1
		var enemy: Enemy = enemy_scene.instantiate()
		enemy.global_position = spawner.global_position
		add_child(enemy)
		EntityPooler.enemy_pool.append(enemy)
		enemy.i = i
