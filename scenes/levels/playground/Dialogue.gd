extends Area2D

@export var json: JSON
@export var dialogue_scene: PackedScene

var dialogue: Dialogue
var in_range := false
var interacted := false

func _input(event: InputEvent) -> void:
	if in_range and event.is_action_pressed("Down") and Player.enable_input == Player.ENABLE_INPUT.ENABLED:
		Player.enable_input = Player.ENABLE_INPUT.DISABLED
		_create_dialogue()
		await dialogue.finished
		interacted = true
		Player.enable_input = Player.ENABLE_INPUT.ENABLED

func _create_dialogue() -> void:
	if dialogue == null:
		dialogue = dialogue_scene.instantiate()
		dialogue.json = json
		Game.instance.ui.add_child(dialogue)
	var ids :Array[int] = dialogue.ids_from_conditions({"first": !interacted})
	dialogue.start(ids)

func _on_body_entered(body: Node2D) -> void:
	in_range = true

func _on_body_exited(body: Node2D) -> void:
	in_range = false
