extends Node2D

@export var enemy_scene: PackedScene
@export var spawn_period := 2.0
@export var max_count := 3

var spawner: Marker2D:
	get: return $Spawner

var entities_node: Node2D:
	get: return owner.get_node("%Enemies")

var dir = 1
const SPEED = 100
const MIN_POS = 0.0
const MAX_POS = 1000.0

var _spawn_timer :float = 0

func _process(delta):
	update_position(delta)
	update_spawning(delta)

func update_position(delta):
	if spawner.global_position.x >= MAX_POS:
		spawner.global_position.x = MAX_POS
		dir = -dir
	elif spawner.global_position.x <= MIN_POS:
		spawner.global_position.x = MIN_POS
		dir = -dir

	spawner.global_position.x += dir * SPEED * delta

func update_spawning(delta):
	_spawn_timer += delta
	if _spawn_timer < spawn_period:
		return
	_spawn_timer = 0
	trigger_spawn()

func trigger_spawn():
	if EntityManager.get_all_of_type(EntityManager.TYPE.ENEMY).size() >= max_count:
		return
	var enemy := EntityManager.new_entity(EntityManager.TYPE.ENEMY, "test")
	enemy.global_position = spawner.global_position
	entities_node.add_child(enemy)
